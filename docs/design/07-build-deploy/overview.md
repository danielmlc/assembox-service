# æ„å»ºå‘å¸ƒéƒ¨ç½²è®¾è®¡

> **çŠ¶æ€**: è®¾è®¡ä¸­
> **æ›´æ–°æ—¥æœŸ**: 2025-01-30
> **è®¾è®¡ç›®æ ‡**: å®ç°ä»é…ç½®åˆ°å¯è¿è¡ŒæœåŠ¡çš„å®Œæ•´æ„å»ºå‘å¸ƒæµç¨‹

---

## 1. æ¦‚è¿°

### 1.1 è®¾è®¡èƒŒæ™¯

æ„å»ºå‘å¸ƒéƒ¨ç½²æ˜¯ä½ä»£ç å¹³å°"ä»£ç ç”Ÿæˆ + æ„å»ºå‘å¸ƒ"æ¨¡å¼çš„ååŠæ®µï¼Œè´Ÿè´£å°†ç”Ÿæˆçš„ä»£ç ç¼–è¯‘ã€æ‰“åŒ…ã€æµ‹è¯•å¹¶éƒ¨ç½²ä¸ºå¯è¿è¡Œçš„æœåŠ¡ã€‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          å®Œæ•´çš„å‘å¸ƒæµç¨‹                                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ é…ç½®è·å–  â”‚ â†’ â”‚ ä»£ç ç”Ÿæˆ  â”‚ â†’ â”‚ ç¼–è¯‘æ ¡éªŒ  â”‚ â†’ â”‚ æ‰“åŒ…é•œåƒ  â”‚ â†’ â”‚ éƒ¨ç½²ä¸Šçº¿  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚       â”‚              â”‚              â”‚              â”‚              â”‚        â”‚
â”‚       â–¼              â–¼              â–¼              â–¼              â–¼        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ å¿«ç…§æœåŠ¡  â”‚   â”‚ ç”Ÿæˆå¼•æ“  â”‚   â”‚ TypeScriptâ”‚   â”‚ Docker    â”‚   â”‚ K8s/å®¹å™¨  â”‚ â”‚
â”‚  â”‚          â”‚   â”‚ ts-morph â”‚   â”‚ ESLint   â”‚   â”‚ é•œåƒä»“åº“  â”‚   â”‚ å¹³å°     â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                       å¥åº·æ£€æŸ¥ & å›æ»šæœºåˆ¶                             â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.2 æ ¸å¿ƒæµç¨‹é˜¶æ®µ

| é˜¶æ®µ | è¾“å…¥ | è¾“å‡º | å·¥å…·/æŠ€æœ¯ |
|-----|------|------|----------|
| é…ç½®è·å– | äº§å“IDã€ç‰ˆæœ¬å· | é…ç½®å¿«ç…§ | å¿«ç…§æœåŠ¡ API |
| ä»£ç ç”Ÿæˆ | é…ç½®å¿«ç…§ | NestJS é¡¹ç›®ä»£ç  | ts-morph |
| ç¼–è¯‘æ ¡éªŒ | é¡¹ç›®ä»£ç  | ç¼–è¯‘äº§ç‰©ã€æ ¡éªŒæŠ¥å‘Š | tscã€ESLint |
| æ‰“åŒ…é•œåƒ | ç¼–è¯‘äº§ç‰© | Docker é•œåƒ | Dockerã€esbuild |
| éƒ¨ç½²ä¸Šçº¿ | Docker é•œåƒ | è¿è¡Œå®ä¾‹ | K8s / Docker Compose |

### 1.3 è®¾è®¡åŸåˆ™

1. **æµæ°´çº¿åŒ–** - æ‰€æœ‰æ­¥éª¤å¯è‡ªåŠ¨åŒ–æ‰§è¡Œï¼Œæ”¯æŒ CI/CD
2. **å¯è¿½æº¯** - æ¯æ¬¡å‘å¸ƒå…³è”å¿«ç…§ç‰ˆæœ¬ã€ä»£ç ç‰ˆæœ¬ã€é•œåƒç‰ˆæœ¬
3. **å¯å›æ»š** - ä¿ç•™å†å²ç‰ˆæœ¬ï¼Œæ”¯æŒå¿«é€Ÿå›æ»š
4. **å¥åº·ä¼˜å…ˆ** - éƒ¨ç½²å‰åè¿›è¡Œå¥åº·æ£€æŸ¥ï¼Œå¤±è´¥è‡ªåŠ¨å›æ»š

---

## 2. å‘å¸ƒæœåŠ¡æ¶æ„

### 2.1 æœåŠ¡å®šä½

å‘å¸ƒæœåŠ¡ï¼ˆassembox-publish-serviceï¼‰æ˜¯ç‹¬ç«‹éƒ¨ç½²çš„å¾®æœåŠ¡ï¼Œè´Ÿè´£æ•´ä¸ªæ„å»ºå‘å¸ƒæµç¨‹çš„ç¼–æ’ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          å‘å¸ƒæœåŠ¡æ¶æ„                                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                    assembox-publish-service                          â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚   â”‚
â”‚  â”‚  â”‚ PublishModule â”‚  â”‚ BuildModule   â”‚  â”‚ DeployModule  â”‚           â”‚   â”‚
â”‚  â”‚  â”‚ å‘å¸ƒä»»åŠ¡ç®¡ç†   â”‚  â”‚ æ„å»ºç¼–è¯‘æ‰“åŒ…  â”‚  â”‚ éƒ¨ç½²ç®¡ç†      â”‚           â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚   â”‚
â”‚  â”‚                                                                     â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚   â”‚
â”‚  â”‚  â”‚ HealthModule  â”‚  â”‚ RollbackModuleâ”‚  â”‚ NotifyModule  â”‚           â”‚   â”‚
â”‚  â”‚  â”‚ å¥åº·æ£€æŸ¥      â”‚  â”‚ å›æ»šç®¡ç†      â”‚  â”‚ é€šçŸ¥å‘Šè­¦      â”‚           â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                     â”‚                                       â”‚
â”‚          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚          â–¼                          â–¼                          â–¼           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ å­˜å‚¨æœåŠ¡       â”‚         â”‚ ä»£ç ç”Ÿæˆå¼•æ“  â”‚         â”‚ Docker/K8s    â”‚    â”‚
â”‚  â”‚ (å¿«ç…§API)     â”‚         â”‚ (æœ¬åœ°æˆ–è¿œç¨‹)  â”‚         â”‚ (éƒ¨ç½²ç›®æ ‡)    â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 æ ¸å¿ƒæ¨¡å—

```typescript
/**
 * å‘å¸ƒæœåŠ¡æ¨¡å—
 */
@Module({
    imports: [
        PublishModule,     // å‘å¸ƒä»»åŠ¡ç®¡ç†
        BuildModule,       // æ„å»ºç¼–è¯‘æ‰“åŒ…
        DeployModule,      // éƒ¨ç½²ç®¡ç†
        HealthModule,      // å¥åº·æ£€æŸ¥
        RollbackModule,    // å›æ»šç®¡ç†
        NotifyModule,      // é€šçŸ¥å‘Šè­¦
    ],
})
export class PublishServiceModule {}
```

---

## 3. å‘å¸ƒä»»åŠ¡ç®¡ç†

### 3.1 å‘å¸ƒä»»åŠ¡çŠ¶æ€æœº

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          å‘å¸ƒä»»åŠ¡çŠ¶æ€æµè½¬                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                      â”‚
â”‚                          â”‚  PENDING  â”‚ ç­‰å¾…ä¸­                               â”‚
â”‚                          â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                                      â”‚
â”‚                                â”‚ å¼€å§‹æ‰§è¡Œ                                    â”‚
â”‚                                â–¼                                            â”‚
â”‚                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                      â”‚
â”‚                          â”‚ PREPARING â”‚ å‡†å¤‡ä¸­ï¼ˆè·å–é…ç½®ï¼‰                    â”‚
â”‚                          â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                                      â”‚
â”‚                                â”‚                                            â”‚
â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                         â”‚
â”‚              â”‚ æˆåŠŸ            â”‚                 â”‚ å¤±è´¥                     â”‚
â”‚              â–¼                 â”‚                 â–¼                          â”‚
â”‚        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚        â”‚ GENERATINGâ”‚ ç”Ÿæˆä¸­    â”‚           â”‚  FAILED   â”‚                   â”‚
â”‚        â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜           â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â”‚              â”‚                 â”‚                 â–²                          â”‚
â”‚              â–¼                 â”‚                 â”‚                          â”‚
â”‚        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚                 â”‚                          â”‚
â”‚        â”‚ BUILDING  â”‚ æ„å»ºä¸­    â”‚                 â”‚                          â”‚
â”‚        â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜           â”‚                 â”‚                          â”‚
â”‚              â”‚                 â”‚                 â”‚                          â”‚
â”‚              â–¼                 â”‚                 â”‚                          â”‚
â”‚        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚                 â”‚                          â”‚
â”‚        â”‚ TESTING   â”‚ æµ‹è¯•ä¸­    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                          â”‚
â”‚        â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜           â”‚                 â”‚                          â”‚
â”‚              â”‚                 â”‚                 â”‚                          â”‚
â”‚              â–¼                 â”‚                 â”‚                          â”‚
â”‚        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚                 â”‚                          â”‚
â”‚        â”‚ DEPLOYING â”‚ éƒ¨ç½²ä¸­    â”‚                 â”‚                          â”‚
â”‚        â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜           â”‚                 â”‚                          â”‚
â”‚              â”‚                 â”‚                 â”‚                          â”‚
â”‚              â–¼                 â”‚                 â”‚                          â”‚
â”‚        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚                 â”‚                          â”‚
â”‚        â”‚ VERIFYING â”‚ éªŒè¯ä¸­    â”‚                 â”‚                          â”‚
â”‚        â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜           â”‚                 â”‚                          â”‚
â”‚              â”‚                 â”‚                 â”‚                          â”‚
â”‚              â–¼                 â”‚                 â”‚                          â”‚
â”‚        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚                 â”‚                          â”‚
â”‚        â”‚ COMPLETED â”‚ å®Œæˆ      â”‚                 â”‚                          â”‚
â”‚        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚                 â”‚                          â”‚
â”‚                                â”‚                 â”‚                          â”‚
â”‚                          å›æ»š  â–¼                 â”‚                          â”‚
â”‚                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚                          â”‚
â”‚                          â”‚ ROLLBACK  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â”‚
â”‚                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                      â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.2 å‘å¸ƒä»»åŠ¡æ•°æ®æ¨¡å‹

```sql
-- å‘å¸ƒä»»åŠ¡è¡¨
CREATE TABLE ab_publish_task (
    id                  BIGINT NOT NULL COMMENT 'ä¸»é”®',
    task_code           VARCHAR(100) NOT NULL COMMENT 'ä»»åŠ¡ç¼–ç ',
    product_id          BIGINT NOT NULL COMMENT 'äº§å“ID',
    product_code        VARCHAR(100) NOT NULL COMMENT 'äº§å“ä»£ç ',
    snapshot_id         BIGINT NOT NULL COMMENT 'å¿«ç…§ID',
    snapshot_version    VARCHAR(50) NOT NULL COMMENT 'å¿«ç…§ç‰ˆæœ¬',

    -- çŠ¶æ€
    status              VARCHAR(20) NOT NULL DEFAULT 'PENDING' COMMENT 'çŠ¶æ€',
    current_stage       VARCHAR(50) COMMENT 'å½“å‰é˜¶æ®µ',
    progress            INT DEFAULT 0 COMMENT 'è¿›åº¦ç™¾åˆ†æ¯”',
    error_message       TEXT COMMENT 'é”™è¯¯ä¿¡æ¯',

    -- æ„å»ºäº§ç‰©
    generated_path      VARCHAR(500) COMMENT 'ç”Ÿæˆä»£ç è·¯å¾„',
    build_log_path      VARCHAR(500) COMMENT 'æ„å»ºæ—¥å¿—è·¯å¾„',
    image_tag           VARCHAR(200) COMMENT 'Dockeré•œåƒæ ‡ç­¾',
    image_digest        VARCHAR(200) COMMENT 'é•œåƒæ‘˜è¦',

    -- éƒ¨ç½²ä¿¡æ¯
    deploy_env          VARCHAR(50) COMMENT 'éƒ¨ç½²ç¯å¢ƒ: dev/test/prod',
    deploy_namespace    VARCHAR(100) COMMENT 'K8så‘½åç©ºé—´',
    deploy_replicas     INT DEFAULT 1 COMMENT 'å‰¯æœ¬æ•°',
    service_url         VARCHAR(500) COMMENT 'æœåŠ¡è®¿é—®åœ°å€',

    -- æ—¶é—´
    started_at          DATETIME COMMENT 'å¼€å§‹æ—¶é—´',
    completed_at        DATETIME COMMENT 'å®Œæˆæ—¶é—´',

    -- å®¡è®¡
    created_at          DATETIME DEFAULT CURRENT_TIMESTAMP,
    creator_id          BIGINT,
    creator_name        VARCHAR(50),

    PRIMARY KEY (id),
    INDEX idx_product (product_id),
    INDEX idx_status (status),
    INDEX idx_created (created_at)
) COMMENT 'å‘å¸ƒä»»åŠ¡è¡¨';

-- å‘å¸ƒé˜¶æ®µæ—¥å¿—è¡¨
CREATE TABLE ab_publish_stage_log (
    id                  BIGINT NOT NULL COMMENT 'ä¸»é”®',
    task_id             BIGINT NOT NULL COMMENT 'ä»»åŠ¡ID',
    stage               VARCHAR(50) NOT NULL COMMENT 'é˜¶æ®µåç§°',
    status              VARCHAR(20) NOT NULL COMMENT 'çŠ¶æ€: RUNNING/SUCCESS/FAILED',
    started_at          DATETIME NOT NULL COMMENT 'å¼€å§‹æ—¶é—´',
    completed_at        DATETIME COMMENT 'å®Œæˆæ—¶é—´',
    duration_ms         INT COMMENT 'è€—æ—¶æ¯«ç§’',
    log_content         TEXT COMMENT 'æ—¥å¿—å†…å®¹',
    error_detail        TEXT COMMENT 'é”™è¯¯è¯¦æƒ…',

    PRIMARY KEY (id),
    INDEX idx_task (task_id)
) COMMENT 'å‘å¸ƒé˜¶æ®µæ—¥å¿—è¡¨';
```

### 3.3 å‘å¸ƒä»»åŠ¡ API

```typescript
/**
 * å‘å¸ƒä»»åŠ¡æ§åˆ¶å™¨
 */
@Controller('publish')
@ApiTags('å‘å¸ƒç®¡ç†')
export class PublishController {

    /**
     * åˆ›å»ºå‘å¸ƒä»»åŠ¡
     */
    @Post('tasks')
    @ApiOperation({ summary: 'åˆ›å»ºå‘å¸ƒä»»åŠ¡' })
    async createTask(@Body() dto: CreatePublishTaskDto): Promise<PublishTask> {
        return this.publishService.createTask(dto);
    }

    /**
     * æ‰§è¡Œå‘å¸ƒä»»åŠ¡
     */
    @Post('tasks/:taskId/execute')
    @ApiOperation({ summary: 'æ‰§è¡Œå‘å¸ƒä»»åŠ¡' })
    async executeTask(@Param('taskId') taskId: string): Promise<PublishTask> {
        return this.publishService.executeTask(taskId);
    }

    /**
     * æŸ¥è¯¢ä»»åŠ¡çŠ¶æ€
     */
    @Get('tasks/:taskId')
    @ApiOperation({ summary: 'æŸ¥è¯¢ä»»åŠ¡çŠ¶æ€' })
    async getTaskStatus(@Param('taskId') taskId: string): Promise<PublishTaskStatus> {
        return this.publishService.getTaskStatus(taskId);
    }

    /**
     * æŸ¥è¯¢ä»»åŠ¡æ—¥å¿—
     */
    @Get('tasks/:taskId/logs')
    @ApiOperation({ summary: 'æŸ¥è¯¢ä»»åŠ¡æ—¥å¿—' })
    async getTaskLogs(@Param('taskId') taskId: string): Promise<StageLog[]> {
        return this.publishService.getTaskLogs(taskId);
    }

    /**
     * å–æ¶ˆä»»åŠ¡
     */
    @Post('tasks/:taskId/cancel')
    @ApiOperation({ summary: 'å–æ¶ˆä»»åŠ¡' })
    async cancelTask(@Param('taskId') taskId: string): Promise<void> {
        return this.publishService.cancelTask(taskId);
    }

    /**
     * å›æ»šåˆ°æŒ‡å®šç‰ˆæœ¬
     */
    @Post('tasks/:taskId/rollback')
    @ApiOperation({ summary: 'å›æ»šå‘å¸ƒ' })
    async rollbackTask(
        @Param('taskId') taskId: string,
        @Body() dto: RollbackDto
    ): Promise<PublishTask> {
        return this.publishService.rollbackTask(taskId, dto);
    }
}
```

---

## 4. æ„å»ºæµç¨‹

### 4.1 æ„å»ºæµæ°´çº¿

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          æ„å»ºæµæ°´çº¿                                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Stage 1: PREPARE å‡†å¤‡é˜¶æ®µ                                           â”‚   â”‚
â”‚  â”‚  â”œâ”€â”€ 1.1 è·å–é…ç½®å¿«ç…§                                                â”‚   â”‚
â”‚  â”‚  â”œâ”€â”€ 1.2 æ ¡éªŒå¿«ç…§å®Œæ•´æ€§                                              â”‚   â”‚
â”‚  â”‚  â”œâ”€â”€ 1.3 åˆ›å»ºå·¥ä½œç›®å½•                                                â”‚   â”‚
â”‚  â”‚  â””â”€â”€ 1.4 å¤åˆ¶æœåŠ¡æ¨¡æ¿                                                â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                     â”‚                                       â”‚
â”‚                                     â–¼                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Stage 2: GENERATE ç”Ÿæˆé˜¶æ®µ                                          â”‚   â”‚
â”‚  â”‚  â”œâ”€â”€ 2.1 ç”Ÿæˆ Entity æ–‡ä»¶                                            â”‚   â”‚
â”‚  â”‚  â”œâ”€â”€ 2.2 ç”Ÿæˆ DTO æ–‡ä»¶                                               â”‚   â”‚
â”‚  â”‚  â”œâ”€â”€ 2.3 ç”Ÿæˆ Controller æ–‡ä»¶                                        â”‚   â”‚
â”‚  â”‚  â”œâ”€â”€ 2.4 ç”Ÿæˆ Service æ–‡ä»¶                                           â”‚   â”‚
â”‚  â”‚  â”œâ”€â”€ 2.5 ç”Ÿæˆ Module æ–‡ä»¶                                            â”‚   â”‚
â”‚  â”‚  â”œâ”€â”€ 2.6 æ›´æ–° app.module.ts                                         â”‚   â”‚
â”‚  â”‚  â””â”€â”€ 2.7 ç”Ÿæˆ manifest.json                                         â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                     â”‚                                       â”‚
â”‚                                     â–¼                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Stage 3: COMPILE ç¼–è¯‘é˜¶æ®µ                                           â”‚   â”‚
â”‚  â”‚  â”œâ”€â”€ 3.1 å®‰è£…ä¾èµ– (npm ci)                                           â”‚   â”‚
â”‚  â”‚  â”œâ”€â”€ 3.2 ESLint æ£€æŸ¥                                                 â”‚   â”‚
â”‚  â”‚  â”œâ”€â”€ 3.3 TypeScript ç¼–è¯‘ (tsc)                                       â”‚   â”‚
â”‚  â”‚  â””â”€â”€ 3.4 esbuild æ‰“åŒ… (ç”Ÿæˆå•æ–‡ä»¶)                                    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                     â”‚                                       â”‚
â”‚                                     â–¼                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Stage 4: TEST æµ‹è¯•é˜¶æ®µ                                              â”‚   â”‚
â”‚  â”‚  â”œâ”€â”€ 4.1 å•å…ƒæµ‹è¯• (å¯é€‰)                                             â”‚   â”‚
â”‚  â”‚  â”œâ”€â”€ 4.2 å¯åŠ¨æœåŠ¡ (æœ¬åœ°)                                             â”‚   â”‚
â”‚  â”‚  â”œâ”€â”€ 4.3 API å†’çƒŸæµ‹è¯•                                                â”‚   â”‚
â”‚  â”‚  â””â”€â”€ 4.4 å¥åº·æ£€æŸ¥ç«¯ç‚¹éªŒè¯                                            â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                     â”‚                                       â”‚
â”‚                                     â–¼                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Stage 5: PACKAGE æ‰“åŒ…é˜¶æ®µ                                           â”‚   â”‚
â”‚  â”‚  â”œâ”€â”€ 5.1 ç”Ÿæˆ Dockerfile                                             â”‚   â”‚
â”‚  â”‚  â”œâ”€â”€ 5.2 æ„å»º Docker é•œåƒ                                            â”‚   â”‚
â”‚  â”‚  â”œâ”€â”€ 5.3 æ¨é€åˆ°é•œåƒä»“åº“                                              â”‚   â”‚
â”‚  â”‚  â””â”€â”€ 5.4 è®°å½•é•œåƒæ‘˜è¦                                                â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.2 æ„å»ºæœåŠ¡å®ç°

```typescript
/**
 * æ„å»ºæœåŠ¡
 */
@Injectable()
export class BuildService {
    constructor(
        private readonly codeGenerator: CodeGenerationService,
        private readonly dockerService: DockerService,
        private readonly logger: LoggerService,
    ) {}

    /**
     * æ‰§è¡Œå®Œæ•´æ„å»º
     */
    async build(task: PublishTask, context: BuildContext): Promise<BuildResult> {
        const stages: StageResult[] = [];

        try {
            // Stage 1: å‡†å¤‡
            stages.push(await this.stagePreapre(task, context));

            // Stage 2: ç”Ÿæˆ
            stages.push(await this.stageGenerate(task, context));

            // Stage 3: ç¼–è¯‘
            stages.push(await this.stageCompile(task, context));

            // Stage 4: æµ‹è¯•
            stages.push(await this.stageTest(task, context));

            // Stage 5: æ‰“åŒ…
            stages.push(await this.stagePackage(task, context));

            return {
                success: true,
                stages,
                imageTag: context.imageTag,
                imageDigest: context.imageDigest,
            };
        } catch (error) {
            return {
                success: false,
                stages,
                error: error.message,
            };
        }
    }

    /**
     * Stage 1: å‡†å¤‡é˜¶æ®µ
     */
    private async stagePreapre(task: PublishTask, context: BuildContext): Promise<StageResult> {
        const stage = this.startStage('PREPARE');

        try {
            // 1.1 è·å–é…ç½®å¿«ç…§
            const snapshot = await this.configService.getSnapshot(task.snapshotId);
            context.snapshot = snapshot;

            // 1.2 æ ¡éªŒå¿«ç…§å®Œæ•´æ€§
            await this.validateSnapshot(snapshot);

            // 1.3 åˆ›å»ºå·¥ä½œç›®å½•
            context.workDir = await this.createWorkDir(task.taskCode);

            // 1.4 å¤åˆ¶æœåŠ¡æ¨¡æ¿
            await this.copyTemplate(context.workDir);

            return this.completeStage(stage, 'SUCCESS');
        } catch (error) {
            return this.completeStage(stage, 'FAILED', error);
        }
    }

    /**
     * Stage 2: ç”Ÿæˆé˜¶æ®µ
     */
    private async stageGenerate(task: PublishTask, context: BuildContext): Promise<StageResult> {
        const stage = this.startStage('GENERATE');

        try {
            const result = await this.codeGenerator.generateProduct(
                task.productId,
                {
                    outputBase: context.workDir,
                    snapshot: context.snapshot,
                }
            );

            context.generatedFiles = result.files;
            return this.completeStage(stage, 'SUCCESS');
        } catch (error) {
            return this.completeStage(stage, 'FAILED', error);
        }
    }

    /**
     * Stage 3: ç¼–è¯‘é˜¶æ®µ
     */
    private async stageCompile(task: PublishTask, context: BuildContext): Promise<StageResult> {
        const stage = this.startStage('COMPILE');

        try {
            // 3.1 å®‰è£…ä¾èµ–
            await this.exec('npm ci', { cwd: context.workDir });

            // 3.2 ESLint æ£€æŸ¥
            const lintResult = await this.exec('npm run lint', { cwd: context.workDir });
            if (lintResult.exitCode !== 0) {
                throw new Error('ESLint æ£€æŸ¥å¤±è´¥');
            }

            // 3.3 TypeScript ç¼–è¯‘
            await this.exec('npm run build', { cwd: context.workDir });

            // 3.4 esbuild æ‰“åŒ…
            await this.bundleWithEsbuild(context.workDir);

            return this.completeStage(stage, 'SUCCESS');
        } catch (error) {
            return this.completeStage(stage, 'FAILED', error);
        }
    }

    /**
     * Stage 4: æµ‹è¯•é˜¶æ®µ
     */
    private async stageTest(task: PublishTask, context: BuildContext): Promise<StageResult> {
        const stage = this.startStage('TEST');

        try {
            // 4.1 å¯åŠ¨æœåŠ¡
            const process = await this.startService(context.workDir);

            // 4.2 ç­‰å¾…æœåŠ¡å°±ç»ª
            await this.waitForReady(process, 30000);

            // 4.3 å¥åº·æ£€æŸ¥
            const healthResult = await this.checkHealth('http://localhost:3000/health');
            if (!healthResult.ok) {
                throw new Error('å¥åº·æ£€æŸ¥å¤±è´¥');
            }

            // 4.4 API å†’çƒŸæµ‹è¯•
            await this.smokeTest(context);

            // å…³é—­æµ‹è¯•æœåŠ¡
            await this.stopService(process);

            return this.completeStage(stage, 'SUCCESS');
        } catch (error) {
            return this.completeStage(stage, 'FAILED', error);
        }
    }

    /**
     * Stage 5: æ‰“åŒ…é˜¶æ®µ
     */
    private async stagePackage(task: PublishTask, context: BuildContext): Promise<StageResult> {
        const stage = this.startStage('PACKAGE');

        try {
            // 5.1 ç”Ÿæˆ Dockerfile
            await this.generateDockerfile(context.workDir);

            // 5.2 æ„å»ºé•œåƒ
            const imageTag = this.buildImageTag(task);
            await this.dockerService.build(context.workDir, imageTag);

            // 5.3 æ¨é€é•œåƒ
            const digest = await this.dockerService.push(imageTag);

            context.imageTag = imageTag;
            context.imageDigest = digest;

            return this.completeStage(stage, 'SUCCESS');
        } catch (error) {
            return this.completeStage(stage, 'FAILED', error);
        }
    }

    /**
     * ç”Ÿæˆ Dockerfile
     */
    private async generateDockerfile(workDir: string): Promise<void> {
        const dockerfile = `
FROM node:20-alpine AS base
WORKDIR /app

# ç”Ÿäº§ç¯å¢ƒä¾èµ–
FROM base AS deps
COPY package*.json ./
RUN npm ci --only=production

# è¿è¡Œæ—¶é•œåƒ
FROM base AS runner
COPY --from=deps /app/node_modules ./node_modules
COPY dist/ ./dist/
COPY config.yaml ./

ENV NODE_ENV=production
EXPOSE 3000

HEALTHCHECK --interval=30s --timeout=10s --start-period=5s --retries=3 \
    CMD wget --no-verbose --tries=1 --spider http://localhost:3000/health || exit 1

CMD ["node", "dist/main.js"]
`;
        await fs.writeFile(path.join(workDir, 'Dockerfile'), dockerfile);
    }
}
```

---

## 5. éƒ¨ç½²æµç¨‹

### 5.1 éƒ¨ç½²ç›®æ ‡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          éƒ¨ç½²ç›®æ ‡æ”¯æŒ                                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Kubernetes (æ¨è)                                                   â”‚   â”‚
â”‚  â”‚  â”œâ”€â”€ Deployment ç®¡ç†                                                 â”‚   â”‚
â”‚  â”‚  â”œâ”€â”€ Service æš´éœ²                                                    â”‚   â”‚
â”‚  â”‚  â”œâ”€â”€ ConfigMap/Secret é…ç½®                                           â”‚   â”‚
â”‚  â”‚  â”œâ”€â”€ HPA è‡ªåŠ¨æ‰©ç¼©å®¹                                                  â”‚   â”‚
â”‚  â”‚  â””â”€â”€ Ingress è·¯ç”±                                                    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Docker Compose (å¼€å‘/æµ‹è¯•)                                          â”‚   â”‚
â”‚  â”‚  â”œâ”€â”€ ç®€å•éƒ¨ç½²                                                        â”‚   â”‚
â”‚  â”‚  â”œâ”€â”€ æœ¬åœ°å¼€å‘                                                        â”‚   â”‚
â”‚  â”‚  â””â”€â”€ å•æœºæµ‹è¯•                                                        â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  äº‘å¹³å°æ‰˜ç®¡ (æ‰©å±•)                                                    â”‚   â”‚
â”‚  â”‚  â”œâ”€â”€ é˜¿é‡Œäº‘ ACK                                                      â”‚   â”‚
â”‚  â”‚  â”œâ”€â”€ è…¾è®¯äº‘ TKE                                                      â”‚   â”‚
â”‚  â”‚  â””â”€â”€ AWS EKS                                                        â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5.2 Kubernetes éƒ¨ç½²æ¸…å•

```yaml
# deployment.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: ${PRODUCT_CODE}-service
  namespace: ${NAMESPACE}
  labels:
    app: ${PRODUCT_CODE}
    version: ${VERSION}
spec:
  replicas: ${REPLICAS}
  selector:
    matchLabels:
      app: ${PRODUCT_CODE}
  template:
    metadata:
      labels:
        app: ${PRODUCT_CODE}
        version: ${VERSION}
    spec:
      containers:
        - name: ${PRODUCT_CODE}
          image: ${IMAGE_TAG}
          ports:
            - containerPort: 3000
          env:
            - name: NODE_ENV
              value: "production"
            - name: CONFIG_PATH
              value: "/app/config/config.yaml"
          envFrom:
            - configMapRef:
                name: ${PRODUCT_CODE}-config
            - secretRef:
                name: ${PRODUCT_CODE}-secrets
          resources:
            requests:
              memory: "256Mi"
              cpu: "100m"
            limits:
              memory: "512Mi"
              cpu: "500m"
          livenessProbe:
            httpGet:
              path: /health
              port: 3000
            initialDelaySeconds: 30
            periodSeconds: 10
          readinessProbe:
            httpGet:
              path: /health/ready
              port: 3000
            initialDelaySeconds: 5
            periodSeconds: 5
          volumeMounts:
            - name: config
              mountPath: /app/config
      volumes:
        - name: config
          configMap:
            name: ${PRODUCT_CODE}-config

---
# service.yaml
apiVersion: v1
kind: Service
metadata:
  name: ${PRODUCT_CODE}-service
  namespace: ${NAMESPACE}
spec:
  selector:
    app: ${PRODUCT_CODE}
  ports:
    - port: 80
      targetPort: 3000
  type: ClusterIP

---
# ingress.yaml
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: ${PRODUCT_CODE}-ingress
  namespace: ${NAMESPACE}
  annotations:
    nginx.ingress.kubernetes.io/rewrite-target: /
spec:
  rules:
    - host: ${SERVICE_HOST}
      http:
        paths:
          - path: /api/${PRODUCT_CODE}
            pathType: Prefix
            backend:
              service:
                name: ${PRODUCT_CODE}-service
                port:
                  number: 80
```

### 5.3 éƒ¨ç½²æœåŠ¡å®ç°

```typescript
/**
 * éƒ¨ç½²æœåŠ¡
 */
@Injectable()
export class DeployService {
    constructor(
        private readonly k8sClient: KubernetesClient,
        private readonly healthChecker: HealthChecker,
        private readonly logger: LoggerService,
    ) {}

    /**
     * éƒ¨ç½²åˆ° Kubernetes
     */
    async deployToK8s(task: PublishTask, config: DeployConfig): Promise<DeployResult> {
        const { namespace, replicas, env } = config;

        try {
            // 1. æ¸²æŸ“éƒ¨ç½²æ¸…å•
            const manifests = await this.renderManifests(task, config);

            // 2. åº”ç”¨éƒ¨ç½²æ¸…å•
            await this.applyManifests(manifests);

            // 3. ç­‰å¾…éƒ¨ç½²å°±ç»ª
            await this.waitForRollout(task.productCode, namespace, 300000);

            // 4. å¥åº·æ£€æŸ¥
            const serviceUrl = await this.getServiceUrl(task.productCode, namespace);
            const healthResult = await this.healthChecker.check(serviceUrl);

            if (!healthResult.healthy) {
                throw new Error(`å¥åº·æ£€æŸ¥å¤±è´¥: ${healthResult.message}`);
            }

            return {
                success: true,
                serviceUrl,
                replicas,
                namespace,
            };
        } catch (error) {
            // éƒ¨ç½²å¤±è´¥ï¼Œè§¦å‘å›æ»š
            await this.rollback(task.productCode, namespace);
            throw error;
        }
    }

    /**
     * æ¸²æŸ“éƒ¨ç½²æ¸…å•
     */
    private async renderManifests(task: PublishTask, config: DeployConfig): Promise<string[]> {
        const templateVars = {
            PRODUCT_CODE: task.productCode,
            VERSION: task.snapshotVersion,
            NAMESPACE: config.namespace,
            REPLICAS: config.replicas,
            IMAGE_TAG: task.imageTag,
            SERVICE_HOST: config.serviceHost,
        };

        const templates = ['deployment.yaml', 'service.yaml', 'ingress.yaml'];
        const manifests: string[] = [];

        for (const template of templates) {
            const content = await this.loadTemplate(template);
            const rendered = this.renderTemplate(content, templateVars);
            manifests.push(rendered);
        }

        return manifests;
    }

    /**
     * ç­‰å¾…éƒ¨ç½²å®Œæˆ
     */
    private async waitForRollout(
        productCode: string,
        namespace: string,
        timeout: number
    ): Promise<void> {
        const deploymentName = `${productCode}-service`;
        const startTime = Date.now();

        while (Date.now() - startTime < timeout) {
            const status = await this.k8sClient.getDeploymentStatus(
                deploymentName,
                namespace
            );

            if (status.ready && status.available === status.replicas) {
                this.logger.info(`éƒ¨ç½²å®Œæˆ: ${deploymentName}`);
                return;
            }

            this.logger.debug(`ç­‰å¾…éƒ¨ç½²: ${status.available}/${status.replicas}`);
            await this.sleep(5000);
        }

        throw new Error(`éƒ¨ç½²è¶…æ—¶: ${deploymentName}`);
    }

    /**
     * å›æ»šéƒ¨ç½²
     */
    async rollback(productCode: string, namespace: string): Promise<void> {
        const deploymentName = `${productCode}-service`;

        this.logger.warn(`å¼€å§‹å›æ»š: ${deploymentName}`);

        await this.k8sClient.rollbackDeployment(deploymentName, namespace);

        await this.waitForRollout(productCode, namespace, 180000);

        this.logger.info(`å›æ»šå®Œæˆ: ${deploymentName}`);
    }
}
```

---

## 6. å¥åº·æ£€æŸ¥

### 6.1 å¥åº·æ£€æŸ¥ç«¯ç‚¹

ç”Ÿæˆçš„æœåŠ¡éœ€è¦åŒ…å«æ ‡å‡†çš„å¥åº·æ£€æŸ¥ç«¯ç‚¹ï¼š

```typescript
/**
 * å¥åº·æ£€æŸ¥æ§åˆ¶å™¨ï¼ˆè‡ªåŠ¨ç”Ÿæˆï¼‰
 */
@Controller('health')
export class HealthController {
    constructor(
        private readonly healthService: HealthService,
    ) {}

    /**
     * å­˜æ´»æ¢é’ˆ
     * GET /health
     */
    @Get()
    async liveness(): Promise<HealthStatus> {
        return {
            status: 'ok',
            timestamp: new Date().toISOString(),
        };
    }

    /**
     * å°±ç»ªæ¢é’ˆ
     * GET /health/ready
     */
    @Get('ready')
    async readiness(): Promise<ReadinessStatus> {
        const checks = await this.healthService.checkAll();

        return {
            status: checks.every(c => c.healthy) ? 'ready' : 'not_ready',
            checks,
            timestamp: new Date().toISOString(),
        };
    }

    /**
     * è¯¦ç»†çŠ¶æ€
     * GET /health/detail
     */
    @Get('detail')
    async detail(): Promise<DetailedHealthStatus> {
        return this.healthService.getDetailedStatus();
    }
}

/**
 * å¥åº·æ£€æŸ¥æœåŠ¡
 */
@Injectable()
export class HealthService {
    async checkAll(): Promise<HealthCheck[]> {
        return [
            await this.checkDatabase(),
            await this.checkRedis(),
            await this.checkDiskSpace(),
            await this.checkMemory(),
        ];
    }

    private async checkDatabase(): Promise<HealthCheck> {
        try {
            await this.dataSource.query('SELECT 1');
            return { name: 'database', healthy: true };
        } catch (error) {
            return { name: 'database', healthy: false, error: error.message };
        }
    }

    private async checkRedis(): Promise<HealthCheck> {
        try {
            await this.redis.ping();
            return { name: 'redis', healthy: true };
        } catch (error) {
            return { name: 'redis', healthy: false, error: error.message };
        }
    }
}
```

### 6.2 å‘å¸ƒåå¥åº·éªŒè¯

```typescript
/**
 * å‘å¸ƒåå¥åº·éªŒè¯
 */
export class PostDeployHealthVerifier {
    /**
     * éªŒè¯æœåŠ¡å¥åº·
     */
    async verify(serviceUrl: string, options: VerifyOptions): Promise<VerifyResult> {
        const { timeout = 60000, retries = 3, interval = 5000 } = options;
        const startTime = Date.now();

        for (let attempt = 1; attempt <= retries; attempt++) {
            try {
                // 1. æ£€æŸ¥å­˜æ´»
                const liveness = await this.checkLiveness(serviceUrl);
                if (!liveness.ok) {
                    throw new Error(`å­˜æ´»æ£€æŸ¥å¤±è´¥: ${liveness.message}`);
                }

                // 2. æ£€æŸ¥å°±ç»ª
                const readiness = await this.checkReadiness(serviceUrl);
                if (!readiness.ok) {
                    throw new Error(`å°±ç»ªæ£€æŸ¥å¤±è´¥: ${readiness.message}`);
                }

                // 3. API å†’çƒŸæµ‹è¯•
                const smoke = await this.smokeTest(serviceUrl);
                if (!smoke.ok) {
                    throw new Error(`å†’çƒŸæµ‹è¯•å¤±è´¥: ${smoke.message}`);
                }

                return {
                    success: true,
                    duration: Date.now() - startTime,
                    checks: { liveness, readiness, smoke },
                };
            } catch (error) {
                this.logger.warn(`å¥åº·éªŒè¯å¤±è´¥ (å°è¯• ${attempt}/${retries}): ${error.message}`);

                if (attempt < retries) {
                    await this.sleep(interval);
                }
            }
        }

        return {
            success: false,
            duration: Date.now() - startTime,
            error: 'å¥åº·éªŒè¯å¤±è´¥ï¼Œå·²è¾¾æœ€å¤§é‡è¯•æ¬¡æ•°',
        };
    }
}
```

---

## 7. ç‰ˆæœ¬ç®¡ç†

### 7.1 ç‰ˆæœ¬å·è§„åˆ™

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          ç‰ˆæœ¬å·ç»„æˆ                                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  é•œåƒæ ‡ç­¾æ ¼å¼:                                                               â”‚
â”‚  registry.example.com/{product-code}:{snapshot-version}-{build-number}     â”‚
â”‚                                                                             â”‚
â”‚  ç¤ºä¾‹:                                                                       â”‚
â”‚  registry.example.com/order-service:v1.2.3-20250130-001                    â”‚
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  registry.example.com  é•œåƒä»“åº“åœ°å€                                  â”‚   â”‚
â”‚  â”‚  order-service         äº§å“ä»£ç                                       â”‚   â”‚
â”‚  â”‚  v1.2.3               å¿«ç…§ç‰ˆæœ¬å·                                     â”‚   â”‚
â”‚  â”‚  20250130             æ„å»ºæ—¥æœŸ                                       â”‚   â”‚
â”‚  â”‚  001                  å½“æ—¥æ„å»ºåºå·                                   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 7.2 ç‰ˆæœ¬å†å²è®°å½•

```sql
-- å‘å¸ƒç‰ˆæœ¬å†å²è¡¨
CREATE TABLE ab_publish_version (
    id                  BIGINT NOT NULL COMMENT 'ä¸»é”®',
    product_id          BIGINT NOT NULL COMMENT 'äº§å“ID',
    product_code        VARCHAR(100) NOT NULL COMMENT 'äº§å“ä»£ç ',
    version             VARCHAR(50) NOT NULL COMMENT 'ç‰ˆæœ¬å·',
    snapshot_id         BIGINT NOT NULL COMMENT 'å¿«ç…§ID',
    task_id             BIGINT NOT NULL COMMENT 'å‘å¸ƒä»»åŠ¡ID',
    image_tag           VARCHAR(200) NOT NULL COMMENT 'é•œåƒæ ‡ç­¾',
    image_digest        VARCHAR(200) NOT NULL COMMENT 'é•œåƒæ‘˜è¦',

    -- éƒ¨ç½²çŠ¶æ€
    deploy_env          VARCHAR(50) NOT NULL COMMENT 'éƒ¨ç½²ç¯å¢ƒ',
    is_current          TINYINT(1) DEFAULT 0 COMMENT 'æ˜¯å¦å½“å‰ç‰ˆæœ¬',
    deployed_at         DATETIME COMMENT 'éƒ¨ç½²æ—¶é—´',

    -- å›æ»šæ ‡è®°
    is_rollback         TINYINT(1) DEFAULT 0 COMMENT 'æ˜¯å¦å›æ»šç‰ˆæœ¬',
    rollback_from       VARCHAR(50) COMMENT 'å›æ»šè‡ªå“ªä¸ªç‰ˆæœ¬',

    -- å®¡è®¡
    created_at          DATETIME DEFAULT CURRENT_TIMESTAMP,
    creator_id          BIGINT,

    PRIMARY KEY (id),
    INDEX idx_product_env (product_id, deploy_env),
    INDEX idx_current (is_current)
) COMMENT 'å‘å¸ƒç‰ˆæœ¬å†å²è¡¨';
```

---

## 8. é€šçŸ¥å‘Šè­¦

### 8.1 é€šçŸ¥åœºæ™¯

| åœºæ™¯ | é€šçŸ¥çº§åˆ« | é€šçŸ¥æ¸ é“ |
|-----|---------|---------|
| å‘å¸ƒå¼€å§‹ | INFO | é’‰é’‰/ä¼å¾® |
| å‘å¸ƒæˆåŠŸ | INFO | é’‰é’‰/ä¼å¾® |
| å‘å¸ƒå¤±è´¥ | ERROR | é’‰é’‰/ä¼å¾® + çŸ­ä¿¡ |
| å¥åº·æ£€æŸ¥å¤±è´¥ | WARN | é’‰é’‰/ä¼å¾® |
| è‡ªåŠ¨å›æ»š | WARN | é’‰é’‰/ä¼å¾® + çŸ­ä¿¡ |

### 8.2 é€šçŸ¥æ¨¡æ¿

```typescript
/**
 * å‘å¸ƒé€šçŸ¥æ¨¡æ¿
 */
const PUBLISH_TEMPLATES = {
    start: `
## ğŸš€ å‘å¸ƒå¼€å§‹
- **äº§å“**: {{productName}}
- **ç‰ˆæœ¬**: {{version}}
- **ç¯å¢ƒ**: {{env}}
- **æ“ä½œäºº**: {{operator}}
- **æ—¶é—´**: {{time}}
`,
    success: `
## âœ… å‘å¸ƒæˆåŠŸ
- **äº§å“**: {{productName}}
- **ç‰ˆæœ¬**: {{version}}
- **ç¯å¢ƒ**: {{env}}
- **æœåŠ¡åœ°å€**: {{serviceUrl}}
- **è€—æ—¶**: {{duration}}
`,
    failed: `
## âŒ å‘å¸ƒå¤±è´¥
- **äº§å“**: {{productName}}
- **ç‰ˆæœ¬**: {{version}}
- **ç¯å¢ƒ**: {{env}}
- **å¤±è´¥é˜¶æ®µ**: {{stage}}
- **é”™è¯¯ä¿¡æ¯**: {{error}}
- **æ“ä½œäºº**: {{operator}}
`,
    rollback: `
## âš ï¸ è‡ªåŠ¨å›æ»š
- **äº§å“**: {{productName}}
- **åŸç‰ˆæœ¬**: {{fromVersion}}
- **å›æ»šåˆ°**: {{toVersion}}
- **åŸå› **: {{reason}}
`,
};
```

---

## 9. è®¾è®¡å†³ç­–

| å†³ç­–ç‚¹ | é€‰æ‹© | åŸå›  |
|-------|------|------|
| æ„å»ºç¯å¢ƒ | å®¹å™¨åŒ–æ„å»º | éš”ç¦»ç¯å¢ƒï¼Œå¯é‡å¤æ„å»º |
| æ‰“åŒ…æ–¹å¼ | esbuild | å¿«é€Ÿæ‰“åŒ…ï¼Œå•æ–‡ä»¶è¾“å‡º |
| éƒ¨ç½²ç›®æ ‡ | K8s ä¼˜å…ˆ | äº‘åŸç”Ÿæ ‡å‡†ï¼Œä¾¿äºæ‰©ç¼©å®¹ |
| å¥åº·æ£€æŸ¥ | ä¸‰çº§æ¢é’ˆ | liveness/readiness/startup |
| å›æ»šç­–ç•¥ | è‡ªåŠ¨å›æ»š | å¥åº·æ£€æŸ¥å¤±è´¥è‡ªåŠ¨å›æ»š |
| ç‰ˆæœ¬ç®¡ç† | é•œåƒæ‘˜è¦ | ä¸å¯å˜éƒ¨ç½²ï¼Œå¯è¿½æº¯ |

---

## 10. ç›¸å…³æ–‡æ¡£

| æ–‡æ¡£ | è¯´æ˜ |
|-----|------|
| [æœåŠ¡å±‚ä»£ç ç”Ÿæˆ](../06-service-gen/overview.md) | ä»£ç ç”Ÿæˆè®¾è®¡ |
| [å­˜å‚¨å±‚å¿«ç…§ç®¡ç†](../01-storage/snapshot-management.md) | å¿«ç…§æœºåˆ¶è®¾è®¡ |
| [ç»„ä»¶ç±»å‹æ‰©å±•](../01-storage/component-types.md) | ç»„ä»¶ç±»å‹å®šä¹‰ |
