# ä¾èµ–ç­–ç•¥è¯´æ˜

## ğŸ“¦ lib/ ç›®å½•çš„ç”¨é€”

**é‡è¦ï¼šlib/ ç›®å½•ä»…ä¾›ä»£ç é˜…è¯»å‚è€ƒï¼Œä¸ä½œä¸º workspace ä¾èµ–ä½¿ç”¨ã€‚**

### è®¾è®¡ç†å¿µ

```
lib/                    # äº‘å¹³å°åŸºç¡€è®¾æ–½åŒ…æºç ï¼ˆä»…ä¾›å‚è€ƒï¼‰
  â”œâ”€â”€ @cs/nest-common   # å·²å‘å¸ƒåˆ° npm: ^3.0.1
  â”œâ”€â”€ @cs/nest-config   # å·²å‘å¸ƒåˆ° npm: ^3.0.3
  â”œâ”€â”€ @cs/nest-redis    # å·²å‘å¸ƒåˆ° npm: ^2.0.0
  â”œâ”€â”€ @cs/nest-typeorm  # å·²å‘å¸ƒåˆ° npm: ^1.1.2
  â”œâ”€â”€ @cs/nest-files    # å·²å‘å¸ƒåˆ° npm: ^1.0.2
  â””â”€â”€ @cs/nest-cloud    # å·²å‘å¸ƒåˆ° npm: ^2.0.2
```

### âœ… æ­£ç¡®çš„ä½¿ç”¨æ–¹å¼

åœ¨ `projects/` ä¸‹çš„æœåŠ¡ä¸­ï¼Œç›´æ¥å®‰è£… npm å‘å¸ƒçš„ç‰ˆæœ¬ï¼š

```bash
# è¿›å…¥æœåŠ¡ç›®å½•
cd projects/assembox-storage

# å®‰è£…äº‘å¹³å°åŸºç¡€è®¾æ–½åŒ…
pnpm add @cs/nest-common@^3.0.1
pnpm add @cs/nest-config@^3.0.3
pnpm add @cs/nest-redis@^2.0.0
pnpm add @cs/nest-typeorm@^1.1.2
pnpm add @cs/nest-files@^1.0.2
pnpm add @cs/nest-cloud@^2.0.2
```

package.json é…ç½®ï¼š

```json
{
  "dependencies": {
    "@cs/nest-common": "^3.0.1",
    "@cs/nest-config": "^3.0.3",
    "@cs/nest-redis": "^2.0.0",
    "@cs/nest-typeorm": "^1.1.2",
    "@cs/nest-files": "^1.0.2",
    "@cs/nest-cloud": "^2.0.2"
  }
}
```

### âŒ é”™è¯¯çš„ä½¿ç”¨æ–¹å¼

**ä¸è¦ä½¿ç”¨ workspace åè®®ï¼š**

```json
{
  "dependencies": {
    "@cs/nest-common": "workspace:^",  // âŒ é”™è¯¯
    "@cs/nest-config": "workspace:^"   // âŒ é”™è¯¯
  }
}
```

## ğŸ¯ ä¸ºä»€ä¹ˆè¿™æ ·è®¾è®¡ï¼Ÿ

### 1. ç‰ˆæœ¬ç®¡ç†
- lib/ ä¸‹çš„åŒ…æœ‰ç‹¬ç«‹çš„å‘å¸ƒå‘¨æœŸ
- ä½¿ç”¨ npm å‘å¸ƒçš„ç‰ˆæœ¬æ›´ç¨³å®šå¯é 
- é¿å…å¼€å‘ä¸­çš„æœªç¨³å®šä»£ç å½±å“ä¸šåŠ¡æœåŠ¡

### 2. ä»£ç å‚è€ƒ
- lib/ æºç æ–¹ä¾¿æŸ¥çœ‹å®ç°ç»†èŠ‚
- å¯ä»¥å¿«é€Ÿå®šä½é—®é¢˜å’Œç†è§£ API
- ä¾¿äºè°ƒè¯•å’Œå­¦ä¹ 

### 3. å›¢é˜Ÿåä½œ
- æ–°æˆå‘˜å¯ä»¥ç›´æ¥ `pnpm install`
- æ— éœ€æ„å»º lib åŒ…å³å¯å¼€å§‹å¼€å‘
- é™ä½å¼€å‘ç¯å¢ƒé…ç½®å¤æ‚åº¦

### 4. æ„å»ºæ•ˆç‡
- ä¸éœ€è¦æ¯æ¬¡éƒ½æ„å»ºåŸºç¡€è®¾æ–½åŒ…
- åŠ å¿« CI/CD æµç¨‹
- å‡å°‘æ„å»ºæ—¶é—´

## ğŸ“š å¸¸è§æ“ä½œ

### æŸ¥çœ‹åŒ…æºç 

```bash
# æŸ¥çœ‹ nest-common æºç 
code lib/nest-common/src

# æŸ¥çœ‹åŒ…ç‰ˆæœ¬
cat lib/nest-common/package.json | grep version
```

### å‡çº§åŸºç¡€è®¾æ–½åŒ…

```bash
# æŸ¥çœ‹ lib ç›®å½•çš„æœ€æ–°ç‰ˆæœ¬
cat lib/nest-common/package.json | grep version

# å‡çº§åˆ°æ–°ç‰ˆæœ¬
cd projects/assembox-storage
pnpm update @cs/nest-common@^3.0.2

# æˆ–è€…é‡æ–°å®‰è£…æŒ‡å®šç‰ˆæœ¬
pnpm add @cs/nest-common@^3.0.2
```

### è°ƒè¯•åŸºç¡€è®¾æ–½åŒ…

å¦‚æœéœ€è¦è°ƒè¯• lib ä¸‹çš„åŒ…ï¼š

1. **åœ¨ lib åŒ…ä¸­æ·»åŠ æ—¥å¿—**
   ```bash
   # ç¼–è¾‘æºç æ·»åŠ  console.log
   code lib/nest-common/src/xxx.ts
   ```

2. **æŸ¥çœ‹å®ç°ç»†èŠ‚**
   - TypeScript ä¼šè‡ªåŠ¨è¯»å– `.d.ts` ç±»å‹å®šä¹‰
   - VSCode å¯ä»¥è·³è½¬åˆ°æºç ï¼ˆCtrl+Clickï¼‰

3. **æäº¤é—®é¢˜**
   - å¦‚æœå‘ç° bugï¼Œå‘åŸºç¡€è®¾æ–½åŒ…ç»´æŠ¤å›¢é˜Ÿæ issue
   - ç­‰å¾…æ–°ç‰ˆæœ¬å‘å¸ƒåå‡çº§

## ğŸ”„ å·¥ä½œåŒºé…ç½®

### pnpm-workspace.yaml

```yaml
packages:
  - 'packages/*'   # å‰ç«¯åŒ…
  - 'docs/*'       # æ–‡æ¡£
  - 'projects/*'   # åç«¯æœåŠ¡ âœ…

# lib/ ä¸åœ¨å·¥ä½œåŒºä¸­
```

### å·¥ä½œåŒºåŒ…åˆ—è¡¨

è¿è¡Œ `pnpm ws:list` åº”è¯¥çœ‹åˆ°ï¼š

```
assembox-monorepo@1.0.0 (æ ¹ç›®å½•)
@cs/assembox-core       (å‰ç«¯)
@cs/assembox-desktop    (å‰ç«¯)
@cs/assembox-editor     (å‰ç«¯)
@cs/assembox-mobile     (å‰ç«¯)
assembox-storage        (åç«¯æœåŠ¡) âœ…
```

æ³¨æ„ï¼šlib/ ä¸‹çš„åŒ…ä¸ä¼šå‡ºç°åœ¨åˆ—è¡¨ä¸­ã€‚

## ğŸš¨ æ³¨æ„äº‹é¡¹

1. **æ°¸è¿œä¸è¦ä¿®æ”¹ lib/ ä¸‹çš„æºç **
   - lib/ æ˜¯åªè¯»å‚è€ƒ
   - å¦‚æœ‰éœ€æ±‚ï¼Œè”ç³»åŸºç¡€è®¾æ–½åŒ…ç»´æŠ¤å›¢é˜Ÿ

2. **ç¡®ä¿ä½¿ç”¨æ­£ç¡®çš„ç‰ˆæœ¬å·**
   - å‚è€ƒ lib/*/package.json çš„ç‰ˆæœ¬å·
   - ä½¿ç”¨ `^` ç‰ˆæœ¬èŒƒå›´ï¼ˆå…è®¸å°ç‰ˆæœ¬æ›´æ–°ï¼‰

3. **å®šæœŸæ›´æ–°ä¾èµ–**
   - å…³æ³¨åŸºç¡€è®¾æ–½åŒ…çš„å‘å¸ƒå…¬å‘Š
   - å®šæœŸè¿è¡Œ `pnpm update` è·å–è¡¥ä¸æ›´æ–°

4. **æ–‡æ¡£ä¼˜å…ˆ**
   - ä¼˜å…ˆæŸ¥çœ‹ lib/*/README.md
   - å¿…è¦æ—¶å†æŸ¥çœ‹æºç 

## ğŸ“– ç›¸å…³æ–‡æ¡£

- [MONOREPO.md](./MONOREPO.md) - å®Œæ•´å¼€å‘æŒ‡å—
- [README.md](./README.md) - é¡¹ç›®ç®€ä»‹
- [COMMANDS.md](./COMMANDS.md) - å‘½ä»¤é€ŸæŸ¥è¡¨
